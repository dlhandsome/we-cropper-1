/**
 * we-cropper v1.3.4
 * (c) 2019 dlhandsome
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.WeCropper=e()}(this,function(){"use strict";var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var t=void 0,r=["touchstarted","touchmoved","touchended"];function i(n){for(var t=arguments,o=[],e=1;e<arguments.length;e++)o[e-1]=t[e];r.forEach(function(t,e){void 0!==o[e]&&(n[t]=o[e])})}function e(){return t||(t=wx.getSystemInfoSync()),t}var a=function(t){return"string"==typeof t},c=Array.isArray,p=function(t){return"function"==typeof t},u=function(t){return null!==t&&"object"==typeof t},n=Object.prototype.toString,v=function(t){return"[object Object]"===n.call(t)};var s=function(){function t(){this._events={}}return t.prototype.$on=function(t,e){var n=this;return c(t)?t.forEach(function(t){a(t)?n.$on(t,e):u(t)&&n.$on(t.event,t.fn)}):(this._events[t]||(this._events[t]=[])).push(e),this},t.prototype.$once=function(){},t.prototype.$off=function(t,e){var n=this;if(!t&&!e)return this._events=Object.create(null),this;if(c(t))return t.forEach(function(t){a(t)?n.$off(t,e):u(t)&&n.$off(t.event,t.fn)}),this;if(!this._events[t])return this;if(!e)return this._events[t]=null,this;if(e)for(var o=this._events[t],r=o.length;r--;){var i=o[r];if(i===e||i.fn===e){o.splice(r,1);break}}return this},t.prototype.$emit=function(t){var e=this,n=(t.toLowerCase(),this._events[t]||[]),o=function(t,e){void 0===e&&(e=0);for(var n=t.length-e,o=new Array(n);n--;)o[n]=t[n+e];return o}(arguments,1);return n.forEach(function(t){try{t.apply(e,o)}catch(t){}}),this},t}(),h={},w={id:{default:"cropper",get:function(){return h.id},set:function(t){"string"!=typeof t&&console.error("id\uff1a"+t+" is invalid"),h.id=t}},width:{default:750,get:function(){return h.width},set:function(t){"number"!=typeof t&&console.error("width\uff1a"+t+" is invalid"),h.width=t}},height:{default:750,get:function(){return h.height},set:function(t){"number"!=typeof t&&console.error("height\uff1a"+t+" is invalid"),h.height=t}},pixelRatio:{default:e().pixelRatio,get:function(){return h.pixelRatio},set:function(t){"number"!=typeof t&&console.error("pixelRatio\uff1a"+t+" is invalid"),h.pixelRatio=t}},scale:{default:2.5,get:function(){return h.scale},set:function(t){"number"!=typeof t&&console.error("scale\uff1a"+t+" is invalid"),h.scale=t}},zoom:{default:5,get:function(){return h.zoom},set:function(t){"number"!=typeof t?console.error("zoom\uff1a"+t+" is invalid"):(t<0||10<t)&&console.error("zoom should be ranged in 0 ~ 10"),h.zoom=t}},src:{default:"",get:function(){return h.src},set:function(t){"string"!=typeof t&&console.error("src\uff1a"+t+" is invalid"),h.src=t}},cut:{default:{},get:function(){return h.cut},set:function(t){"object"!=typeof t&&console.error("cut\uff1a"+t+" is invalid"),h.cut=t}},boundStyle:{default:{},get:function(){return h.boundStyle},set:function(t){"object"!=typeof t&&console.error("boundStyle\uff1a"+t+" is invalid"),h.boundStyle=t}},onReady:{default:null,get:function(){return h.ready},set:function(t){h.ready=t}},onBeforeImageLoad:{default:null,get:function(){return h.beforeImageLoad},set:function(t){h.beforeImageLoad=t}},onImageLoad:{default:null,get:function(){return h.imageLoad},set:function(t){h.imageLoad=t}},onBeforeDraw:{default:null,get:function(){return h.beforeDraw},set:function(t){h.beforeDraw=t}}},b=e().windowWidth;function f(o){return function(t){return void 0===t&&(t={}),new Promise(function(e,n){t.success=function(t){e(t)},t.fail=function(t){n(t)},o(t)})}}var y=f(wx.getImageInfo),x=f(wx.canvasToTempFilePath),d="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var l,g=(function(u,f){!function(t){var e=f,n=u&&u.exports==e&&u,o="object"==typeof d&&d;o.global!==o&&o.window!==o||(t=o);var r=function(t){this.message=t};(r.prototype=new Error).name="InvalidCharacterError";var s=function(t){throw new r(t)},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=/[\t\n\f\r ]/g,i={encode:function(t){t=String(t),/[^\0-\xFF]/.test(t)&&s("The string to be encoded contains characters outside of the Latin1 range.");for(var e,n,o,r,i=t.length%3,a="",c=-1,u=t.length-i;++c<u;)e=t.charCodeAt(c)<<16,n=t.charCodeAt(++c)<<8,o=t.charCodeAt(++c),a+=h.charAt((r=e+n+o)>>18&63)+h.charAt(r>>12&63)+h.charAt(r>>6&63)+h.charAt(63&r);return 2==i?(e=t.charCodeAt(c)<<8,n=t.charCodeAt(++c),a+=h.charAt((r=e+n)>>10)+h.charAt(r>>4&63)+h.charAt(r<<2&63)+"="):1==i&&(r=t.charCodeAt(c),a+=h.charAt(r>>2)+h.charAt(r<<4&63)+"=="),a},decode:function(t){var e=(t=String(t).replace(c,"")).length;e%4==0&&(e=(t=t.replace(/==?$/,"")).length),(e%4==1||/[^+a-zA-Z0-9/]/.test(t))&&s("Invalid character: the string to be decoded is not correctly encoded.");for(var n,o,r=0,i="",a=-1;++a<e;)o=h.indexOf(t.charAt(a)),n=r%4?64*n+o:o,r++%4&&(i+=String.fromCharCode(255&n>>(-2*r&6)));return i},version:"0.1.0"};if(e&&!e.nodeType)if(n)n.exports=i;else for(var a in i)i.hasOwnProperty(a)&&(e[a]=i[a]);else t.base64=i}(d)}(l={exports:{}},l.exports),l.exports);function m(t){var e="";if("string"==typeof t)e=t;else for(var n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return g.encode(e)}function C(t,e,n,o,r,i,a){var c,u,s,h,f,d;void 0===a&&(a=function(){}),void 0===i&&(i="png"),i="image/"+i.toLowerCase().replace(/jpg/i,"jpeg").match(/png|jpeg|bmp|gif/)[0],/bmp/.test(i)?(c=t,u=e,s=n,h=o,f=r,d=function(t){var e=function(t){var e=t.width,n=t.height,o=e*n*3,r=o+54,i=[66,77,255&r,r>>8&255,r>>16&255,r>>24&255,0,0,0,0,54,0,0,0],a=[40,0,0,0,255&e,e>>8&255,e>>16&255,e>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255,1,0,24,0,0,0,0,0,255&o,o>>8&255,o>>16&255,o>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c=(4-3*e%4)%4,u=t.data,s="",h=e<<2,f=n,d=String.fromCharCode;do{for(var l=h*(f-1),g="",p=0;p<e;p++){var v=p<<2;g+=d(u[l+v+2])+d(u[l+v+1])+d(u[l+v])}for(var y=0;y<c;y++)g+=String.fromCharCode(0);s+=g}while(--f);return m(i.concat(a))+m(s)}(t);p(a)&&a("data:"+("image/"+i)+";base64,"+e)},wx.canvasGetImageData({canvasId:c,x:u,y:s,width:h,height:f,success:function(t){d(t)},fail:function(t){d(null),console.error("canvasGetImageData error: "+t)}})):console.error("\u6682\u4e0d\u652f\u6301\u751f\u6210'"+i+"'\u7c7b\u578b\u7684base64\u56fe\u7247")}var S={convertToImage:C,convertToBMP:function(t,e){var n=void 0===t?{}:t;return void 0===e&&(e=function(){}),C(n.canvasId,n.x,n.y,n.width,n.height,"bmp",e)}},_=function(t,e,n,o,r){var i,a;return i=Math.round(r.x-o.x),a=Math.round(r.y-o.y),t+.001*n*(Math.round(Math.sqrt(i*i+a*a))-e)};function M(u){u.src&&(u.__oneTouchStart=function(t){u.touchX0=Math.round(t.x),u.touchY0=Math.round(t.y)},u.__oneTouchMove=function(t){var e,n;if(u.touchended)return u.updateCanvas();e=Math.round(t.x-u.touchX0),n=Math.round(t.y-u.touchY0);var o=Math.round(u.rectX+e),r=Math.round(u.rectY+n);u.outsideBound(o,r),u.updateCanvas()},u.__twoTouchStart=function(t,e){var n,o,r;u.touchX1=Math.round(u.rectX+u.scaleWidth/2),u.touchY1=Math.round(u.rectY+u.scaleHeight/2),n=Math.round(e.x-t.x),o=Math.round(e.y-t.y),r=Math.round(Math.sqrt(n*n+o*o)),u.oldDistance=r},u.__twoTouchMove=function(t,e){var n=u.oldScale,o=u.oldDistance,r=u.scale,i=u.zoom;u.newScale=_(n,o,i,t,e),u.newScale<=1&&(u.newScale=1),u.newScale>=r&&(u.newScale=r),u.scaleWidth=Math.round(u.newScale*u.baseWidth),u.scaleHeight=Math.round(u.newScale*u.baseHeight);var a=Math.round(u.touchX1-u.scaleWidth/2),c=Math.round(u.touchY1-u.scaleHeight/2);u.outsideBound(a,c),u.updateCanvas()},u.__xtouchEnd=function(){u.oldScale=u.newScale,u.rectX=u.imgLeft,u.rectY=u.imgTop})}function I(c){var t=c.width,e=c.height,u=c.id,s=c.targetId,h=c.pixelRatio,n=c.cut,o=n.x,f=void 0===o?0:o,r=n.y,d=void 0===r?0:r,i=n.width,l=void 0===i?t:i,a=n.height,g=void 0===a?e:a;c.updateCanvas=function(t){return c.croperTarget&&c.ctx.drawImage(c.croperTarget,c.imgLeft,c.imgTop,c.scaleWidth,c.scaleHeight),c.$emit("beforeDraw"),c.setBoundStyle(c.boundStyle),c.ctx.draw(!1,t),c},c.pushOrign=function(t){return c.src=t,c.$emit("beforeImageLoad"),y({src:t}).then(function(t){var e=t.width/t.height,n=l/g;return c.croperTarget=t.path,e<n?(c.rectX=f,c.baseWidth=l,c.baseHeight=l/e,c.rectY=d-Math.abs((g-c.baseHeight)/2)):(c.rectY=d,c.baseWidth=g*e,c.baseHeight=g,c.rectX=f-Math.abs((l-c.baseWidth)/2)),c.imgLeft=c.rectX,c.imgTop=c.rectY,c.scaleWidth=c.baseWidth,c.scaleHeight=c.baseHeight,M(c),new Promise(function(t){c.updateCanvas(t)})}).then(function(){p(c.onImageLoad)&&c.onImageLoad(c.ctx,c)})},c.getCropperBase64=function(t){void 0===t&&(t=function(){}),S.convertToBMP({canvasId:u,x:f,y:d,width:l,height:g},t)},c.getCropperImage=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];var o=e[0],r=e[e.length-1],i={canvasId:u,x:f,y:d,width:l,height:g},a=function(){return Promise.resolve()};return v(o)&&o.original&&(a=function(){return c.targetCtx.drawImage(c.croperTarget,c.imgLeft*h,c.imgTop*h,c.scaleWidth*h,c.scaleHeight*h),i={canvasId:s,x:f*h,y:d*h,width:l*h,height:g*h},e=c.targetCtx,void 0===n&&(n=!1),new Promise(function(t){e.draw(n,t)});var e,n}),a().then(function(){return v(o)&&(i=Object.assign({},i,o)),x(i)}).then(function(t){var e=t.tempFilePath;return p(r)&&r.call(c,e),e}).catch(function(){p(r)&&r.call(c,null)})}}return function(m){function t(t){var e=m.call(this)||this;e.version="1.3.4";var n,o,r,s,h,f,i,a,d,c,l,u,g,p,v,y=e,x={};return n=y,o=w,Object.defineProperties(n,o),Object.keys(w).forEach(function(t){x[t]=w[t].default}),Object.assign(y,x,t),(r=y).attachPage=function(){var t=getCurrentPages(),e=t[t.length-1];Object.defineProperty(e,"wecropper",{get:function(){return console.warn("Instance will not be automatically bound to the page after v1.4.0\n\nPlease use a custom instance name instead\n\nExample: \nthis.mycropper = new WeCropper(options)\n\n// ...\nthis.mycropper.getCropperImage()"),r}})},r.createCtx=function(){var t=r.id,e=r.targetId;t?(r.ctx=r.ctx||wx.createCanvasContext(t),r.targetCtx=r.targetCtx||wx.createCanvasContext(e)):console.error("constructor: create canvas context failed, 'id' must be valuable")},r.deviceRadio=b/750,r.attachPage(),r.createCtx(),h=(s=y).width,f=s.height,i=s.cut,a=i.x,d=void 0===a?0:a,c=i.y,l=void 0===c?0:c,u=i.width,g=void 0===u?h:u,p=i.height,v=void 0===p?f:p,s.outsideBound=function(t,e){s.imgLeft=d<=t?d:s.scaleWidth+t-d<=g?d+g-s.scaleWidth:t,s.imgTop=l<=e?l:s.scaleHeight+e-l<=v?l+v-s.scaleHeight:e},s.setBoundStyle=function(t){var e=void 0===t?{}:t,n=e.color,o=void 0===n?"#04b00f":n,r=e.mask,i=void 0===r?"rgba(0, 0, 0, 0.3)":r,a=e.lineWidth,c=void 0===a?1:a,u=[{start:{x:d-c,y:l+10-c},step1:{x:d-c,y:l-c},step2:{x:d+10-c,y:l-c}},{start:{x:d-c,y:l+v-10+c},step1:{x:d-c,y:l+v+c},step2:{x:d+10-c,y:l+v+c}},{start:{x:d+g-10+c,y:l-c},step1:{x:d+g+c,y:l-c},step2:{x:d+g+c,y:l+10-c}},{start:{x:d+g+c,y:l+v-10+c},step1:{x:d+g+c,y:l+v+c},step2:{x:d+g-10+c,y:l+v+c}}];s.ctx.beginPath(),s.ctx.setFillStyle(i),s.ctx.fillRect(0,0,d,f),s.ctx.fillRect(d,0,g,l),s.ctx.fillRect(d,l+v,g,f-l-v),s.ctx.fillRect(d+g,0,h-d-g,f),s.ctx.fill(),u.forEach(function(t){s.ctx.beginPath(),s.ctx.setStrokeStyle(o),s.ctx.setLineWidth(c),s.ctx.moveTo(t.start.x,t.start.y),s.ctx.lineTo(t.step1.x,t.step1.y),s.ctx.lineTo(t.step2.x,t.step2.y),s.ctx.stroke()})},I(y),y.init(),M(y),y}return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(t,m),t.prototype.init=function(){var t=this,e=t.src;return t.$emit("ready"),e?t.pushOrign(e):t.updateCanvas(),i(t,!1,!1,!1),t.oldScale=1,t.newScale=1,t},t.prototype.touchStart=function(t){var e=t.touches,n=e[0],o=e[1];this.src&&(i(this,!0,null,null),this.__oneTouchStart(n),2<=t.touches.length&&this.__twoTouchStart(n,o))},t.prototype.touchMove=function(t){var e=t.touches,n=e[0],o=e[1];this.src&&(i(this,null,!0),1===t.touches.length&&this.__oneTouchMove(n),2<=t.touches.length&&this.__twoTouchMove(n,o))},t.prototype.touchEnd=function(t){this.src&&(i(this,!1,!1,!0),this.__xtouchEnd())},t}(s)});